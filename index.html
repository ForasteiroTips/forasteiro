<script>
  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
    return null;
  }

  function gerarIdAleatorio() {
    return Math.random().toString(36).substring(2, 15);
  }

  function irTelegram() {
    const fbp = getCookie('_fbp') || gerarIdAleatorio();
    const fbc = getCookie('_fbc') || gerarIdAleatorio();
    const eventId = "lead_" + Date.now();

    fbq('track', 'Lead');

    fetch("https://meta-capi-server.onrender.com/send-event", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        event_name: "Lead",
        event_id: eventId,
        user_data: {
          client_user_agent: navigator.userAgent,
          fbp,
          fbc
        }
      })
    }).finally(() => {
      window.location.href = "https://maper.info/forasteirotips";
    });
  }

  window.addEventListener('DOMContentLoaded', () => {
    const fbp = getCookie('_fbp') || gerarIdAleatorio();
    const fbc = getCookie('_fbc') || gerarIdAleatorio();
    const eventId = "pgview_" + Date.now();

    fetch("https://meta-capi-server.onrender.com/send-event", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        event_name: "PageView",
        event_id: eventId,
        user_data: {
          client_user_agent: navigator.userAgent,
          fbp,
          fbc
        }
      })
    });
  });
</script>
